@import scala.collection.mutable._ 
@(categories: MutableList[Category],currentCategory:models.Category, currentPackage:models.AssetPackage, isAuthed:Boolean, user:models.User, packageComments:MutableList[Comment], currentPackageUser:models.User)

@main("RPGBOSS Asset Server - "+currentCategory.name,isAuthed, user) {

    @leftcol(categories, currentCategory)
    <div class="col-xs-9">
        <h1>@currentPackage.name</h1>
        <h4>Version: @currentPackage.version</h4>
        <div class="images-area">
            <div class="row">
            @if(currentPackage.pictures!="") {
                @currentPackage.getAllImages().map { file:String =>
                    <div class="image-view col-xs-4"> 
                        <img src="/dynimage/@file" alt="">
                    </div>
                }
            }
            </div>
        </div>
        <br><br>
        <p>@Html(currentPackage.description)</p>
        <div class="row line">
            <div class="col-xs-6">
                <h4>This package is lincensed as</h4>
                
                @if(currentPackage.license==0) {
                    <a target="_blank" href="http://creativecommons.org/publicdomain/zero/1.0/">Free</a>
                }
                @if(currentPackage.license==1) {
                    <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Free (author in credits)</a>
                }
                @if(currentPackage.license==2) {
                    <a target="_blank" href="http://creativecommons.org/licenses/by-sa/4.0/">Free (author in credits, remix same license)</a>
                }
            </div>
            <div class="col-xs-6">
                <h4>From user</h4>
                <a href="/user/@currentPackageUser.id">@currentPackageUser.display_name</a>
            </div>
           
        </div>
        @if(isAuthed) {
        	<a href="@currentPackage.url" class="button full">Download</a>
        } else {
        	<a href="/login" class="button full">Login to download</a>
        }
        <div class="box notfixed gap comment-section">
            <h1>User Comments</h1>
            @packageComments.map { row:Comment =>
            <div class="comment">
                <h4>@row.User.display_name</h4>
                <p>
                    @for( a <- 1 to 5) {
                        @if(row.rating>=a) {
                            <span class="icon-star active"></span>
                        } else {
                            <span class="icon-star"></span>
                        }
                    }
                </p>
                <p>@Html(row.content)</p>
                <div class="line"></div>
                <span class="date">@row.created_at</span>
            </div>
            }
        </div>
        @if(isAuthed) {
            <h3>Comment</h3>
            <form class="comment-section" method="post" action="/comment/add/@currentPackage.id?redirect=/c/@currentCategory.slug/@currentPackage.id/@currentPackage.slug">
                <span>Rate this package</span>
                <div class="stars-selection">
                    <span data-value="1" class="icon-star"></span>
                    <span data-value="2" class="icon-star"></span>
                    <span data-value="3" class="icon-star"></span>
                    <span data-value="4" class="icon-star"></span>
                    <span data-value="5" class="icon-star"></span>
                </div>
                <input type="hidden" value="3" id="rating" name="rating">
                <br>
                <span>You have <strong><span id="charsleft">0 / 255</span></strong> of characters left.</span>
                <textarea name="text" id="" cols="30" rows="10"></textarea>
                <br>
                <input type="submit" class="button" value="Make a Comment">
            </form>
        }
    </div>

        <script src="@routes.Assets.at("javascripts/ckeditor/ckeditor.js")"></script>
        <script>

        function paintStars(value) {
            $('.stars-selection span').removeClass('active');
            for (var i = value - 1; i >= 0; i--) {
                $('.stars-selection span').eq(i).addClass('active');
            };
        }

        $('.stars-selection span').mouseover(function() {
            var value = $(this).attr('data-value');
            paintStars(value);
            $(this).addClass('active');
        }).mouseout(function() {
            var originalVal = $('#rating').val();
            paintStars(originalVal);
            
        }).click(function() {
            var value = $(this).attr('data-value');
            $('#rating').val(value);
            paintStars(value);
        });
        paintStars(3);

        function UpdateTextLength() {
            var current = CKEDITOR.instances['text'].getData().length,
                    maxlength = 255;

            document.getElementById('charsleft').innerHTML = (maxlength-current) + " / " + maxlength;
        }

        CKEDITOR.replace( 'text' );
        CKEDITOR.instances['text'].on('key', UpdateTextLength);
        CKEDITOR.instances['text'].on('paste', UpdateTextLength);
        CKEDITOR.instances['text'].on('keypress', UpdateTextLength);
        CKEDITOR.instances['text'].on('blur', UpdateTextLength);
        CKEDITOR.instances['text'].on('change', UpdateTextLength);
        UpdateTextLength();


    </script>

}
